name: deploy to  azure okk
on: 
 push:
   branches:
     - dev-branch


jobs:
  build:
   runs-on: ubuntu-latest 

   steps:
     - name: actions/checkout 
       uses: actions/checkout@v2 
     - name: login to azure 
       uses: azure/login@v1
       with:
         creds: ${{secrets.AZURE_CREDENTIALS}}

     - name: deploy to azure aks 
       run: | 
        kubectl create -f ./kubernetes/namespace.yaml --validate=false
 
        kubectl create -f ./kubernetes/deployment.yaml 
        kubectl create -f ./kubernetes/service.yaml 
        kubectl get deployment -n dev-namespace 
        kubectl get service -n dev-namespace
       

        kubectl get ns 
  second-job:
    runs-on: ubuntu-latest 
    needs: build
    steps:
      - name: port forward 
        run: |
           kubectl port-forward service/myservice 9090:80 -n dev-namespace
            






